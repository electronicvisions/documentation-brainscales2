

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Structured Neurons &mdash; BrainScaleS-2 Documentation 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/visions.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Train DNNs on BrainScaleS-2" href="tutorial_7-yin_yang_itl.html" />
    <link rel="prev" title="BrainScaleS-2 on-chip plasticity experiment" href="tutorial_5-plasticity_rate_coding.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> BrainScaleS-2 Documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Demos &amp; Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="tutorial_0-welcome.html">Welcome to the BrainScaleS-2 Tutorial</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tutorial_1-single_neuron.html">BrainScaleS-2 single neuron experiments</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_2-superspike.html">Learning with the SuperSpike rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_3-hagen_intro.html">Introduction to matrix multiplication</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_4-hagen_properties.html">Exploring the analog MAC operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_5-plasticity_rate_coding.html">BrainScaleS-2 on-chip plasticity experiment</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Structured Neurons</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#imports-and-calibration">Imports and Calibration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#constructing-a-compartment-chain">Constructing a Compartment Chain</a></li>
<li class="toctree-l4"><a class="reference internal" href="#external-input-and-experiment-definition">External Input and Experiment Definition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performing-the-experiment">Performing the Experiment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_0-welcome.html#executing-the-notebooks">Executing the Notebooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_0-welcome.html#shared-hardware-resources">Shared Hardware Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_0-welcome.html#final-test-hardware-execution">Final test: Hardware Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_1-single_neuron.html">BrainScaleS-2 single neuron experiments</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_2-superspike.html">Learning with the SuperSpike rule</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_3-hagen_intro.html">Introduction to matrix multiplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_4-hagen_properties.html">Exploring the analog MAC operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_5-plasticity_rate_coding.html">BrainScaleS-2 on-chip plasticity experiment</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Structured Neurons</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#imports-and-calibration">Imports and Calibration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constructing-a-compartment-chain">Constructing a Compartment Chain</a></li>
<li class="toctree-l3"><a class="reference internal" href="#external-input-and-experiment-definition">External Input and Experiment Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performing-the-experiment">Performing the Experiment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#questions">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_7-yin_yang_itl.html">Train DNNs on BrainScaleS-2</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_8-dynamic_range.html">Exploring the dynamic range</a></li>
<li class="toctree-l2"><a class="reference internal" href="wolke7_networks.html">Neuronenverbindungen - Synapsen</a></li>
<li class="toctree-l2"><a class="reference internal" href="wolke7_networks.html#synapsennetzwerke">Synapsennetzwerke</a></li>
<li class="toctree-l2"><a class="reference internal" href="fp_0-welcome.html">Welcome to the Advanced Physics Lab for Physicists by the Electronic Vision(s) Group</a></li>
<li class="toctree-l2"><a class="reference internal" href="fp_pynn_introduction.html">Introduction to PyNN</a></li>
<li class="toctree-l2"><a class="reference internal" href="fp_binary_operations.html">Binary operations using spiking neurons</a></li>
<li class="toctree-l2"><a class="reference internal" href="fp_sudoku.html">Sudoku</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../apis.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BrainScaleS-2 Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Welcome to the BrainScaleS-2 Demos &amp; Examples!</a> &raquo;</li>
        
          <li><a href="tutorial_0-welcome.html">Welcome to the BrainScaleS-2 Tutorial</a> &raquo;</li>
        
      <li>Structured Neurons</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/brainscales2-demos/tutorial_6-multicompartment.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="structured-neurons">
<h1>Structured Neurons<a class="headerlink" href="#structured-neurons" title="Permalink to this headline">¶</a></h1>
<p>In the previous demonstrations we considered point neuron models.
However, biological neurons often posses elaborate dendritic trees, which allow them to pre-process the synaptic inputs before they reach the somatic spike initiation zone near the axon initial segment.
Taking dendrites as well as their passive and active properties into account can greatly enhance the computational power of neurons [1-3].</p>
<p>In order to investigate the features of structured neurons, BrainScaleS-2 offers the possibility to connect several neuron circuits to form multi-compartmental neuron models.
The following figure shows a sketch of two neuron circuits and the electronic (<strong>not</strong> synaptic) connections they can establish.</p>
<a class="reference internal image-reference" href="../_images/multicompartment_connections.png"><img alt="../_images/multicompartment_connections.png" class="align-center" src="../_images/multicompartment_connections.png" style="width: 500px;" /></a>
<p>Horizontal switches <span class="math notranslate nohighlight">\(S_{mh}\)</span> and vertical switches <span class="math notranslate nohighlight">\(S_{mv}\)</span> allow to connect neighboring neuron circuits directly – they form a single, isopotential compartment.
This can be useful to increase the fan-in of a single compartment as it is now connected to several columns of the synapse array or might be needed to realize certain multi-compartmental models (see the code example below).</p>
<p>In addition to these “membrane connections” each neuron circuit can also connect either directly (<span class="math notranslate nohighlight">\(S_{ms}\)</span>) or via a conductance <span class="math notranslate nohighlight">\(R_{ms}\)</span> to a “shared line”.
This offers the possibility to connect several compartments via conductances and to form various multi-compartmental neuron models.
multi
We will demonstrate the implementation of a multi-compartmental model by the example of a compartment chain and will investigate how excitatory postsynaptic potentials propagate along the chain.
The following figure displays a sketch of a chain with four compartments in the top part; in the bottom the hardware implementation is illustrated.</p>
<a class="reference internal image-reference" href="../_images/multicompartment_chain_model.png"><img alt="../_images/multicompartment_chain_model.png" class="align-center" src="../_images/multicompartment_chain_model.png" style="width: 500px;" /></a>
<p>The rest of this demo will motivate why we chose this hardware implementation and will show how this model can be emulated on the BrainScaleS-2 system.
You can find more detailed information about the multi-compartmental capabilities, example configurations and experiments with structured neurons in Kaiser et al. 2021 [4].</p>
<div class="admonition-references-for-further-reading admonition">
<p class="admonition-title">References for further reading</p>
<ol class="arabic simple">
<li><p>Poirazi, P., Brannon, T., Mel, B.W., 2003. Pyramidal neuron as two-layer neural network. Neuron 37, 989–999. doi:<a class="reference external" href="https://www.doi.org/10.1016/s0896-6273(03)00149-1">10.1016/s0896-6273(03)00149-1</a></p></li>
<li><p>London, M., Häusser, M., 2005. Dendritic computation. Annu. Rev. Neurosci.  28, 503–532. doi:<a class="reference external" href="https://www.doi.org/10.1146/annurev.neuro.28.061604.135703">10.1146/annurev.neuro.28.061604.135703</a></p></li>
<li><p>Major, G., Larkum, M.E., Schiller, J., 2013. Active properties of neocortical pyramidal neuron dendrites. Annual Review of Neuroscience 36, 1–24. doi:<a class="reference external" href="https://www.doi.org/10.1146/annurev-neuro-062111-150343">10.1146/annurev-neuro-062111-150343</a></p></li>
<li><p>Kaiser, J., Billaudelle, S., Müller, E., Tetzlaff, C., Schemmel, J., and Schmitt, S., 2022. Emulating dendritic computing paradigms on analog neuromorphic hardware. Neuroscience. doi:<a class="reference external" href="https://www.doi.org/10.1016/j.neuroscience.2021.08.013">10.1016/j.neuroscience.2021.08.013</a></p></li>
</ol>
</div>
<div class="section" id="imports-and-calibration">
<h2>Imports and Calibration<a class="headerlink" href="#imports-and-calibration" title="Permalink to this headline">¶</a></h2>
<p>Once again we have to set some environment variables for our microscheduler first:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">_static.common.helpers</span> <span class="kn">import</span> <span class="n">setup_hardware_client</span>
<span class="n">setup_hardware_client</span><span class="p">()</span>
</pre></div>
</div>
<p>We continue by importing several Python packages, which we need to perform our experiment.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widget</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">quantities</span> <span class="k">as</span> <span class="nn">pq</span>

<span class="kn">import</span> <span class="nn">pynn_brainscales.brainscales2</span> <span class="k">as</span> <span class="nn">pynn</span>
</pre></div>
</div>
<p>A default calibration is generated for every setup every night.
We save the nightly calibration in two variables such that we can use it later when we define our neuronal network.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">_static.common.helpers</span> <span class="kn">import</span> <span class="n">get_nightly_calibration</span>
<span class="n">calib</span> <span class="o">=</span> <span class="n">get_nightly_calibration</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we can start setting up our network:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># setup PyNN and inject calibration data</span>
<span class="n">pynn</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">initial_config</span><span class="o">=</span><span class="n">calib</span><span class="p">)</span>
</pre></div>
</div>
<p>Furthermore, we define some global parameters which we need for the construction of the chain and the external stimulus.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">length</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Number of compartments in the chain</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># Number of concurrent input spikes</span>
</pre></div>
</div>
</div>
<div class="section" id="constructing-a-compartment-chain">
<h2>Constructing a Compartment Chain<a class="headerlink" href="#constructing-a-compartment-chain" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">HXNeuron</span></code> allows to set all relevant parameters of the BrainScaleS-2 neuron circuits.
It particularly allows to control the direct connections between neuron circuits and the connections to the somatic line.</p>
<p>We will now create a chain of compartments, which are connected via conductances.
Each compartment in the middle of the chain has two neighbors.
Therefore, these compartments have to establish two connections via the somatic line.
As a consequence each is made up of two neuron circuits: the first will connect to the somatic line via the conductance and the second via the switch.</p>
<p>In order to form the chain with <code class="docutils literal notranslate"><span class="pre">length</span></code> compartments, we create a set (population) of <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">length</span></code> neuron circuits (<code class="docutils literal notranslate"><span class="pre">HXNeurons</span></code>); note that we use two neuron circuits for the first and last compartment as well even though it is not strictly needed.
We will use the second neuron circuit to determine the properties of the compartment such as capacitance and leak potential.
We choose the second neuron circuit since we will later also use this circuits adjustable resistance to connect it to its neighboring compartment.
Consequently, we disable the leak (set the leak conductance to zero) for the first circuit and set its capacitance to zero.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pop</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="n">length</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                      <span class="n">pynn</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">HXNeuron</span><span class="p">())</span>

<span class="c1"># Combine two neuron circuits to one compartment; &quot;disable&quot; first</span>
<span class="c1"># neuron circuit</span>
<span class="n">pynn</span><span class="o">.</span><span class="n">PopulationView</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">length</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">multicompartment_connect_right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">leak_i_bias</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">leak_enable_division</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">membrane_capacitance_capacitance</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>As mentioned before, one of the circuits connects via a conductance to the somatic line and the other via the switch.
In order to establish connections between the compartments, we have to close the somatic line for every second neuron circuit.
This time we have to ignore the first and last compartment as they only have one connection to the somatic line.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable direct connection to somatic line for even neuron circuits</span>
<span class="c1"># (don&#39;t connect first neuron circuit)</span>
<span class="n">pynn</span><span class="o">.</span><span class="n">PopulationView</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">length</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">multicompartment_connect_soma</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Connect resistor to somatic line and close connection to the right</span>
<span class="c1"># for uneven circuits (don&#39;t connect last neuron circuit)</span>
<span class="n">pynn</span><span class="o">.</span><span class="n">PopulationView</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="n">multicompartment_enable_conductance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">multicompartment_i_bias_nmda</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
        <span class="n">multicompartment_connect_soma_right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Disable spiking</span>
<span class="n">pop</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">threshold_enable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Every uneven neuron circuit controls the capacitance, resistance,</span>
<span class="c1"># leak, ... of a single compartment. Save views on these circuits as</span>
<span class="c1"># compartments</span>
<span class="n">compartments</span> <span class="o">=</span> <span class="p">[</span><span class="n">pynn</span><span class="o">.</span><span class="n">PopulationView</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span>
                <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">length</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="external-input-and-experiment-definition">
<h2>External Input and Experiment Definition<a class="headerlink" href="#external-input-and-experiment-definition" title="Permalink to this headline">¶</a></h2>
<p>We create stimulus neurons which inject synaptic inputs in one compartment after another.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isi</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># ms (hw): time between inputs</span>
<span class="n">spike_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="o">*</span> <span class="n">isi</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">isi</span>  <span class="c1"># ms (hw)</span>
<span class="c1"># Inject stimulus in one compartment after another</span>
<span class="n">projections</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">spike_time</span><span class="p">,</span> <span class="n">compartment</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">spike_times</span><span class="p">,</span> <span class="n">compartments</span><span class="p">):</span>
    <span class="n">pop_in</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">SpikeSourceArray</span><span class="p">(</span>
        <span class="n">spike_times</span><span class="o">=</span><span class="p">[</span><span class="n">spike_time</span><span class="p">]))</span>

    <span class="c1"># Note: the weight will be set later</span>
    <span class="n">synapse_type</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">standardmodels</span><span class="o">.</span><span class="n">synapses</span><span class="o">.</span><span class="n">StaticSynapse</span><span class="p">()</span>
    <span class="n">projections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">pynn</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">pop_in</span><span class="p">,</span> <span class="n">compartment</span><span class="p">,</span>
                        <span class="n">pynn</span><span class="o">.</span><span class="n">AllToAllConnector</span><span class="p">(),</span>
                        <span class="n">synapse_type</span><span class="o">=</span><span class="n">synapse_type</span><span class="p">))</span>
</pre></div>
</div>
<p>Now we define a function which runs the experiment on the BrainScaleS-2 system.
Since we use a single ADC (analog-to-digital converter) to record the membrane potential of each compartment, we have to perform <code class="docutils literal notranslate"><span class="pre">length</span></code> hardware runs.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">record_membrane_traces</span><span class="p">(</span><span class="n">weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">conductance</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run emulation on BSS-2 and record membrane traces of each compartment.</span>

<span class="sd">    :param weight: Weight of stimulus projection. Value range: [0, 63].</span>
<span class="sd">    :param conductance: Conductance between compartments. Value range</span>
<span class="sd">        [0, 1022].</span>

<span class="sd">    :return List of recorded membrane traces.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set parameters</span>
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">compartments</span><span class="p">:</span>
        <span class="n">comp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">multicompartment_i_bias_nmda</span><span class="o">=</span><span class="n">conductance</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">proj</span> <span class="ow">in</span> <span class="n">projections</span><span class="p">:</span>
        <span class="n">proj</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>


    <span class="c1"># Run on hardware and record mebrane potentials</span>
    <span class="n">membrane_traces</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">compartments</span><span class="p">:</span>
        <span class="n">comp</span><span class="o">.</span><span class="n">record</span><span class="p">([</span><span class="s1">&#39;v&#39;</span><span class="p">])</span>

        <span class="n">pynn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">length</span> <span class="o">*</span> <span class="n">isi</span><span class="p">)</span>
        <span class="n">pynn</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="n">membrane_traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span><span class="o">.</span><span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">irregularlysampledsignals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">comp</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">membrane_traces</span>
</pre></div>
</div>
<p>Furthermore, we define a function which plots the defined membrane traces.
For that purpose we create a grid of size <code class="docutils literal notranslate"><span class="pre">length</span> <span class="pre">x</span> <span class="pre">length</span></code>.
Each cell in this grid will contain a subplot which displays the membrane response in a single compartment to a single input.
We will change the recording site in the x-axis and the injection site on the y-axis.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_membrane_traces</span><span class="p">(</span><span class="n">membrane_traces</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">old_traces</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display recorded membrane traces.</span>

<span class="sd">    Split the recorded membrane trace of each compartment and create a grid of</span>
<span class="sd">    reponses in which the recording site changes in the horizontal direction</span>
<span class="sd">    and the injection site in the vertical direction.</span>

<span class="sd">    :param membrane_traces: List of recorded membrane traces of the different</span>
<span class="sd">        compartments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">membrane_traces</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">plot_single</span><span class="p">(</span><span class="n">traces</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Helper function to plot membrane traces recorded in a single experiment.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">injected</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">measured</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
                <span class="n">membrane_trace</span> <span class="o">=</span> <span class="n">traces</span><span class="p">[</span><span class="n">measured</span><span class="p">]</span>
                <span class="n">input_time</span> <span class="o">=</span> <span class="n">spike_times</span><span class="p">[</span><span class="n">injected</span><span class="p">]</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">ms</span>

                <span class="n">signal</span> <span class="o">=</span> <span class="n">membrane_trace</span><span class="o">.</span><span class="n">time_slice</span><span class="p">(</span>
                    <span class="n">t_start</span><span class="o">=</span><span class="n">input_time</span> <span class="o">-</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                    <span class="n">t_stop</span><span class="o">=</span><span class="n">input_time</span> <span class="o">+</span> <span class="mf">0.06</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>

                <span class="c1"># Normalize voltage and times</span>
                <span class="n">signal</span><span class="o">.</span><span class="n">times</span> <span class="o">=</span> <span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">times</span> <span class="o">-</span> <span class="n">input_time</span><span class="p">)</span><span class="o">.</span><span class="n">rescale</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">us</span><span class="p">)</span>
                <span class="n">signal</span> <span class="o">=</span> <span class="n">signal</span> <span class="o">-</span> <span class="n">signal</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                <span class="n">axs</span><span class="p">[</span><span class="n">injected</span><span class="p">,</span> <span class="n">measured</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">plot_single</span><span class="p">(</span><span class="n">membrane_traces</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">old_traces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_single</span><span class="p">(</span><span class="n">old_traces</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Hide all but one axis</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="o">-</span><span class="n">length</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Add &quot;global&quot; axis with annotations</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Membrane Voltage (MADC)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Hardware Time (us)&#39;</span><span class="p">)</span>


    <span class="n">pad</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\triangleleft$ change recording site $\triangleright$&#39;</span><span class="p">,</span>
                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad</span><span class="p">),</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\triangleleft$ change injection site $\triangleright$&#39;</span><span class="p">,</span>
                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="performing-the-experiment">
<h2>Performing the Experiment<a class="headerlink" href="#performing-the-experiment" title="Permalink to this headline">¶</a></h2>
<p>Finally, we can execute the experiment on the BrainScaleS-2 system.
For that purpose we use the functions defined in the previous section.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">old_traces</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">Slider</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nd">@widget</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="n">Slider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">63</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">31</span><span class="p">),</span>
                 <span class="n">conductance</span><span class="o">=</span><span class="n">Slider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1022</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">500</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">conductance</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">old_traces</span>
    <span class="n">membrane_traces</span> <span class="o">=</span> <span class="n">record_membrane_traces</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">conductance</span><span class="p">)</span>
    <span class="n">plot_membrane_traces</span><span class="p">(</span><span class="n">membrane_traces</span><span class="p">,</span> <span class="n">old_traces</span><span class="p">)</span>
    <span class="n">old_traces</span> <span class="o">=</span> <span class="n">membrane_traces</span>
</pre></div>
</div>
<a class="solution reference internal image-reference" href="../_images/multicompartment_chain_solution.png"><img alt="../_images/multicompartment_chain_solution.png" class="solution align-center" src="../_images/multicompartment_chain_solution.png" style="width: 800px;" /></a>
<div class="section" id="questions">
<h3>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>How does the conductance influence the attenuation of the EPSP?
How does it affect the height of the EPSP in the compartment in which it was injected?</p></li>
<li><p>Do you see an effect due to the finite chain length?</p></li>
</ul>
<p>Last but not least, we tell PyNN that we finished all our experiments.
Uncomment and execute the following line once you want to finish the experiment.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pynn.end()</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="tutorial_7-yin_yang_itl.html" class="btn btn-neutral float-right" title="Train DNNs on BrainScaleS-2" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="tutorial_5-plasticity_rate_coding.html" class="btn btn-neutral float-left" title="BrainScaleS-2 on-chip plasticity experiment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Electronic Vision(s).

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>