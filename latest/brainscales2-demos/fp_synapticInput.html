<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Synaptic Input for Neurons &mdash; BrainScaleS-2 Documentation 0.0.1 documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/visions.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Complex Neuron Dynamics with a Silicon Adaptive Exponential Integrate-and-Fire Neuron" href="fp_adex_complex_dynamics.html" />
    <link rel="prev" title="Calibration: Characterising and Measuring Analog Behaviour" href="fp_calibration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            BrainScaleS-2 Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Demos &amp; Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.html">Demos and Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="girlsday.html">Wie verarbeitet unser Gehirn Informationen?</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="fortgeschrittenen_praktikum.html">Welcome to the Advanced Physics Lab for Physicists by the Electronic Vision(s) Group</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="fp_biological-background.html">Biological background</a></li>
<li class="toctree-l3"><a class="reference internal" href="fp_neuromorphic-computing.html">Neuromorphic computing</a></li>
<li class="toctree-l3"><a class="reference internal" href="fp_brainscales.html">The BrainScaleS-2 system</a></li>
<li class="toctree-l3"><a class="reference internal" href="fp_pynn_introduction.html">Introduction to PyNN</a></li>
<li class="toctree-l3"><a class="reference internal" href="fp_lui.html">Lu.i experiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="fp_singleNeuron.html">Investigating a single neuron</a></li>
<li class="toctree-l3"><a class="reference internal" href="fp_synfireChain.html">A simple feedforward network</a></li>
<li class="toctree-l3"><a class="reference internal" href="fp_sudoku.html">Solving sudokus with BrainScaleS-2</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="fortgeschrittenen_praktikum.html#optional-experiments">Optional experiments</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="fp_calibration.html">Calibration: Characterising and Measuring Analog Behaviour</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Synaptic Input for Neurons</a></li>
<li class="toctree-l4"><a class="reference internal" href="fp_adex_complex_dynamics.html">Complex Neuron Dynamics with a Silicon Adaptive Exponential Integrate-and-Fire Neuron</a></li>
<li class="toctree-l4"><a class="reference internal" href="fp_multicompartment.html">Multicompartmental Neurons</a></li>
<li class="toctree-l4"><a class="reference internal" href="fp_superspike.html">Learning with the SuperSpike rule</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../software_components.html">Software Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BrainScaleS-2 Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Welcome to the BrainScaleS-2 Demos &amp; Examples!</a></li>
          <li class="breadcrumb-item"><a href="fortgeschrittenen_praktikum.html">Welcome to the Advanced Physics Lab for Physicists by the Electronic Vision(s) Group</a></li>
      <li class="breadcrumb-item active">Synaptic Input for Neurons</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/brainscales2-demos/fp_synapticInput.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="synaptic-input-for-neurons">
<h1>Synaptic Input for Neurons<a class="headerlink" href="#synaptic-input-for-neurons" title="Permalink to this headline"></a></h1>
<p>In this task you will investigate a single neuron receiving <em>excitatory</em> or <em>inhibitory</em> input. We begin with a situation in which the neuron does not fire in response to input, by disabling the reset mechanism and then in the last section investigate firing in response to input. The goal of the task is to familiarise yourself with the analog non-idealities that arise from a physical realisation of the idealised model equations. You will characterise different sources of noise in the system and get a feeling for the influence the hardware parameters on the temporal behaviour.</p>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline"></a></h2>
<p>Generally speaking you will need to run this cell only at the beginning or after something is broken. The easiest way to escape from a broken state, will be to select “Kernel -&gt; Restart” in the menu above and reexecute the following two cells.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">_static.common.helpers</span> <span class="kn">import</span> <span class="n">setup_hardware_client</span>
<span class="n">setup_hardware_client</span><span class="p">()</span>
</pre></div>
</div>
<p>A default calibration is generated for every setup every night.
We save the nightly calibration in a variable such that we can use it later when we define our experiment.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">_static.common.helpers</span> <span class="kn">import</span> <span class="n">get_nightly_calibration</span>
<span class="n">calib</span> <span class="o">=</span> <span class="n">get_nightly_calibration</span><span class="p">()</span>
</pre></div>
</div>
<p>We will also setup a folder to save experimental results in</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>

<span class="n">results_folder</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;results/task3&#39;</span><span class="p">)</span>
<span class="n">results_folder</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="plotting">
<h3>Plotting<a class="headerlink" href="#plotting" title="Permalink to this headline"></a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pynn_brainscales.brainscales2</span> <span class="kn">import</span> <span class="n">Population</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;_static/matplotlibrc&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_membrane_dynamics</span><span class="p">(</span><span class="n">times</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">voltages</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param times: sample times</span>
<span class="sd">    :param voltages: voltages to plot</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">voltages</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wall clock time [ms]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;ADC readout [a.u.]&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_population_dynamics</span><span class="p">(</span><span class="n">population</span><span class="p">:</span> <span class="n">Population</span><span class="p">,</span> <span class="n">segment_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the membrane potential of the neuron in a given population view. Only</span>
<span class="sd">    population views of size 1 are supported.</span>
<span class="sd">    :param population: Population, membrane traces and spikes are plotted for.</span>
<span class="sd">    :param segment_id: Index of the neo segment to be plotted. Defaults to</span>
<span class="sd">                       -1, encoding the last recorded segment.</span>
<span class="sd">    :param ylim: y-axis limits for the plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Plotting is supported for populations of size 1.&quot;</span><span class="p">)</span>
    <span class="c1"># Experimental results are given in the &#39;neo&#39; data format</span>
    <span class="n">mem_v</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">segments</span><span class="p">[</span><span class="n">segment_id</span><span class="p">]</span><span class="o">.</span><span class="n">irregularlysampledsignals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">spikes</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;spikes&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">spiketrains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mem_v</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">mem_v</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

    <span class="c1"># indicate the spikes as red dots</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mem_v</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">spikes</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wall clock time [ms]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;ADC readout [a.u.]&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylim</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="synaptic-parameters">
<h2>Synaptic Parameters<a class="headerlink" href="#synaptic-parameters" title="Permalink to this headline"></a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">quantities</span> <span class="k">as</span> <span class="nn">pq</span>

<span class="kn">import</span> <span class="nn">pynn_brainscales.brainscales2</span> <span class="k">as</span> <span class="nn">pynn</span>

<span class="kn">from</span> <span class="nn">pynn_brainscales.brainscales2</span> <span class="kn">import</span> <span class="n">Population</span>
<span class="kn">from</span> <span class="nn">pynn_brainscales.brainscales2.standardmodels.cells</span> <span class="kn">import</span> <span class="n">SpikeSourceArray</span>
<span class="kn">from</span> <span class="nn">pynn_brainscales.brainscales2.standardmodels.synapses</span> <span class="kn">import</span> <span class="n">StaticSynapse</span>
</pre></div>
</div>
<p>Create a neuron and inject a single spike.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># save results of this experiment in subfolder</span>
<span class="n">exercise_folder</span> <span class="o">=</span> <span class="n">results_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;synaptic_parameters&#39;</span><span class="p">)</span>
<span class="n">exercise_folder</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="experiments">
<h3>Experiments<a class="headerlink" href="#experiments" title="Permalink to this headline"></a></h3>
<p>Adjust the synaptic parameters and display the membrane traces.</p>
<ul class="simple">
<li><p>What do the different parameters control?</p></li>
</ul>
<p>By setting the “weight” parameter to be negative the neuron will receive
inhibitory synaptic input.</p>
<ul class="simple">
<li><p>What differences compared to the excitatory input can you observe?</p></li>
</ul>
<p>Now enable the membrane threshold and adjust it in such a way that you ellicit one spike.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">IntSlider</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="n">IntSlider</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">IntSlider</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">tqdm.notebook</span> <span class="k">as</span> <span class="nn">tqdm</span>


<span class="nd">@interact</span><span class="p">(</span>
    <span class="n">tau</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1022</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">26</span><span class="p">),</span>
    <span class="n">gm</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1022</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1022</span><span class="p">),</span>
    <span class="n">weight</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mi">63</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">63</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">63</span><span class="p">),</span>
    <span class="n">n_runs</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">threshold_v_threshold</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">300</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">experiment</span><span class="p">(</span>
    <span class="n">tau</span><span class="p">,</span>
    <span class="n">gm</span><span class="p">,</span>
    <span class="n">weight</span><span class="p">,</span>
    <span class="n">n_runs</span><span class="p">,</span>
    <span class="n">threshold_v_threshold</span><span class="p">,</span>
    <span class="n">threshold_enable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">savefig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">results</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="n">synapse_type</span> <span class="o">=</span> <span class="s1">&#39;inhibitory&#39;</span> <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;excitatory&#39;</span>
    <span class="c1"># parameters</span>
    <span class="n">experiment_duration</span> <span class="o">=</span> <span class="mf">0.4</span>  <span class="c1"># ms (hw domain)</span>
    <span class="n">pynn</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">initial_config</span><span class="o">=</span><span class="n">calib</span><span class="p">)</span>
    <span class="n">neuron</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">HXNeuron</span><span class="p">(</span>
        <span class="n">excitatory_input_i_bias_tau</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span>
        <span class="n">excitatory_input_i_bias_gm</span><span class="o">=</span><span class="n">gm</span><span class="p">,</span>
        <span class="n">inhibitory_input_i_bias_tau</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span>
        <span class="n">inhibitory_input_i_bias_gm</span><span class="o">=</span><span class="n">gm</span><span class="p">,</span>
        <span class="c1"># neuron to be observed: disable threshold such we can observe PSP shape</span>
        <span class="n">threshold_enable</span><span class="o">=</span><span class="n">threshold_enable</span><span class="p">,</span>
        <span class="n">threshold_v_threshold</span><span class="o">=</span><span class="n">threshold_v_threshold</span>
    <span class="p">))</span>
    <span class="n">neuron</span><span class="o">.</span><span class="n">record</span><span class="p">([</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;spikes&quot;</span><span class="p">])</span>

    <span class="c1"># external input</span>
    <span class="n">spike_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">experiment_duration</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">pop_input</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">pynn</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">SpikeSourceArray</span><span class="p">(</span><span class="n">spike_times</span><span class="o">=</span><span class="n">spike_times</span><span class="p">))</span>

    <span class="n">synapse</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">standardmodels</span><span class="o">.</span><span class="n">synapses</span><span class="o">.</span><span class="n">StaticSynapse</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">pop_input</span><span class="p">,</span> <span class="n">neuron</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">AllToAllConnector</span><span class="p">(),</span>
                       <span class="n">synapse_type</span><span class="o">=</span><span class="n">synapse</span><span class="p">,</span> <span class="n">receptor_type</span><span class="o">=</span><span class="n">synapse_type</span><span class="p">)</span>

    <span class="c1"># run experiment</span>
    <span class="n">voltages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mems</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">min_shape</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span>

    <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">trange</span><span class="p">(</span><span class="n">n_runs</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">pynn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">experiment_duration</span><span class="p">)</span>
        <span class="n">mem</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">irregularlysampledsignals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mem</span><span class="p">)</span>
        <span class="n">voltages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mem</span><span class="p">))</span>
        <span class="n">min_shape</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mem</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">min_shape</span><span class="p">)</span>
        <span class="n">pynn</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="n">voltages</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[:</span><span class="n">min_shape</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voltages</span><span class="p">]</span>
    <span class="n">voltages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">voltages</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plot_membrane_dynamics</span><span class="p">(</span><span class="n">mems</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">times</span><span class="p">[:</span><span class="n">min_shape</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">voltages</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">exercise_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;membrane_trace.png&#39;</span><span class="p">))</span>

    <span class="n">pynn</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mems</span><span class="p">,</span> <span class="n">voltages</span><span class="p">,</span> <span class="n">mems</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">times</span><span class="p">[:</span><span class="n">min_shape</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="solution">
<h3>Solution<a class="headerlink" href="#solution" title="Permalink to this headline"></a></h3>
<p>Please enter your answers to the questions above here…</p>
</div>
<div class="section" id="normalising-the-membrane-dynamics">
<h3>Normalising the Membrane Dynamics<a class="headerlink" href="#normalising-the-membrane-dynamics" title="Permalink to this headline"></a></h3>
<p>We can use the experiment above to determine the minimum and maximum of the membrane dynamics over a number of runs.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">determine_vmax_vmin</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">gm</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">v_threshold</span><span class="p">,</span> <span class="n">n_runs</span><span class="p">):</span>
    <span class="n">mems</span><span class="p">,</span> <span class="n">voltages</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">(</span><span class="n">tau</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span> <span class="n">gm</span><span class="o">=</span><span class="n">gm</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">n_runs</span><span class="o">=</span><span class="n">n_runs</span><span class="p">,</span>    <span class="n">threshold_enable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">threshold_v_threshold</span><span class="o">=</span><span class="n">v_threshold</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">v_max</span><span class="p">,</span> <span class="n">v_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">voltages</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">voltages</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span>

<span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span> <span class="o">=</span> <span class="n">determine_vmax_vmin</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1022</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">63</span><span class="p">,</span> <span class="n">v_threshold</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">n_runs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be used to normalise the membrane voltage measurements. Note that this normalisation depends on the choices of hyperparameters $\tau$, $g_m$, $v_\mathrm{th}$ used to obtain it. The idea is to map $v_\mathrm{th}$ to $1$ and $v_\mathrm{reset}$ to $0$, although this will only be approximately true for all membrane traces.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normalise_voltage</span><span class="p">(</span><span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">normalise</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
        <span class="n">delta_v</span> <span class="o">=</span> <span class="n">v_max</span> <span class="o">-</span> <span class="n">v_min</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">delta_v</span> <span class="o">*</span> <span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">normalise</span>

<span class="n">nv</span> <span class="o">=</span> <span class="n">normalise_voltage</span><span class="p">(</span><span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="trial-to-trial-variations">
<h2>Trial-to-Trial Variations<a class="headerlink" href="#trial-to-trial-variations" title="Permalink to this headline"></a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1022</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">gm</span> <span class="o">=</span> <span class="mi">1022</span>
<span class="n">weight</span> <span class="o">=</span> <span class="mi">63</span>
<span class="n">n_runs</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">max_voltages</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">baselines</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">taus</span><span class="p">):</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">(</span><span class="n">tau</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span> <span class="n">gm</span><span class="o">=</span><span class="n">gm</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">n_runs</span><span class="o">=</span><span class="n">n_runs</span><span class="p">,</span> <span class="n">threshold_v_threshold</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">v_baseline</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_voltages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">baselines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_baseline</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">taus</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">max_voltages</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">baselines</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tau</span> <span class="o">=</span> <span class="mi">26</span>
<span class="n">gm</span> <span class="o">=</span> <span class="mi">1022</span>
<span class="n">weight</span> <span class="o">=</span> <span class="mi">63</span>
<span class="n">n_runs</span> <span class="o">=</span> <span class="mi">200</span> <span class="c1"># each run takes some time (with this value it should finish in less than 1-2 minutes)</span>

<span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">(</span><span class="n">tau</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span> <span class="n">gm</span><span class="o">=</span><span class="n">gm</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">n_runs</span><span class="o">=</span><span class="n">n_runs</span><span class="p">,</span> <span class="n">threshold_v_threshold</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">v_baseline</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">max_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="o">-</span><span class="n">v_baseline</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">histogram</span><span class="p">(</span><span class="n">heights</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;height of peaks [MADC]&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;counts&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">heights</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span><span class="n">max_v</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also sweep weight dependence of synaptic input</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tau</span> <span class="o">=</span> <span class="mi">26</span>
<span class="n">gm</span> <span class="o">=</span> <span class="mi">1022</span>
<span class="n">n_runs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">n_sub</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="n">n_sub</span><span class="p">)</span>
<span class="n">category_colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)(</span><span class="mf">0.5</span><span class="o">+</span><span class="n">ws</span><span class="o">/</span><span class="mi">128</span><span class="p">)</span>

<span class="n">max_mean_v</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">trange</span><span class="p">(</span><span class="n">n_sub</span><span class="p">):</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">(</span><span class="n">tau</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span> <span class="n">gm</span><span class="o">=</span><span class="n">gm</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">ws</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">n_runs</span><span class="o">=</span><span class="n">n_runs</span><span class="p">,</span> <span class="n">threshold_v_threshold</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">v_baseline</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_runs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">v_baseline</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">category_colors</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">v_baseline</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">category_colors</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">ws</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>

    <span class="n">max_mean_v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sign</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">v_baseline</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wall clock time [ms]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;ADC readout [a.u.]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="exercises">
<h3>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Plot the maximum of the voltages we obtained</p></li>
</ul>
</div>
<div class="section" id="id1">
<h3>Solution<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h3>
<p>Please enter your solution here…</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="c1"># TODO</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="fixed-pattern-noise">
<h2>Fixed-Pattern Noise<a class="headerlink" href="#fixed-pattern-noise" title="Permalink to this headline"></a></h2>
<p>Investigate the fixed pattern noise between synapses/synapse drivers.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract_heights</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span> <span class="n">spike_times</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Extract the PSP heights from a membrane trace where several inputs</span>
<span class="sd">    where injected one after another.</span>

<span class="sd">    :param voltage: Recorded membrane trace</span>
<span class="sd">    :param spike_times: Input spike times for the different inputs in ms</span>
<span class="sd">        (hw domain).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># determine baseline voltage</span>
    <span class="n">v_baseline</span> <span class="o">=</span> <span class="n">voltage</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># extract for each synapse the maximum in the membrane trace and</span>
    <span class="c1"># substact the baseline voltage</span>
    <span class="n">heights</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># determine how many samples are recorded between inputs</span>
    <span class="n">idx_first_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">voltage</span><span class="o">.</span><span class="n">times</span> <span class="o">-</span> <span class="n">spike_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">pq</span><span class="o">.</span><span class="n">ms</span><span class="p">))</span>
    <span class="n">samples_per_input</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">idx_first_input</span>

    <span class="c1"># loop over inputs</span>
    <span class="k">for</span> <span class="n">n_input</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spike_times</span><span class="p">)):</span>
        <span class="n">start_stop</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">n_input</span><span class="p">)</span> <span class="o">*</span> <span class="n">samples_per_input</span>
        <span class="n">input_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">start_stop</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">start_stop</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">voltage</span><span class="p">[</span><span class="n">input_slice</span><span class="p">])</span> <span class="o">-</span> <span class="n">v_baseline</span>
        <span class="n">heights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">height</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">heights</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># save results of this experiment in subfolder</span>
<span class="n">exercise_folder</span> <span class="o">=</span> <span class="n">results_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;fixed_pattern_noise&#39;</span><span class="p">)</span>
<span class="n">exercise_folder</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fixed_pattern_noise_experiment</span><span class="p">():</span>
    <span class="c1"># parameters</span>
    <span class="n">n_synapses</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="mi">63</span>
    <span class="n">time_between_inputs</span> <span class="o">=</span> <span class="mf">0.4</span>

    <span class="n">pynn</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">initial_config</span><span class="o">=</span><span class="n">calib</span><span class="p">)</span>

    <span class="c1"># neuron to be observed: disable threshold such we can observe PSP shape</span>
    <span class="n">neuron</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">HXNeuron</span><span class="p">(</span><span class="n">threshold_enable</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="n">neuron</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span>

    <span class="c1"># external input</span>
    <span class="c1"># since we want to test several external synapses, we create a population</span>
    <span class="c1"># of external neurons which spike one after another</span>
    <span class="n">spike_times</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_synapses</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">time_between_inputs</span>
    <span class="c1"># SpikeSourceArray expects a list of spike times for each neuron in the</span>
    <span class="c1"># population -&gt; reshape</span>
    <span class="n">pop_input</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="n">n_synapses</span><span class="p">,</span>
        <span class="n">pynn</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">SpikeSourceArray</span><span class="p">(</span><span class="n">spike_times</span><span class="o">=</span><span class="n">spike_times</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>

    <span class="n">synapse</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">standardmodels</span><span class="o">.</span><span class="n">synapses</span><span class="o">.</span><span class="n">StaticSynapse</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">pop_input</span><span class="p">,</span> <span class="n">neuron</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">AllToAllConnector</span><span class="p">(),</span>
                           <span class="n">synapse_type</span><span class="o">=</span><span class="n">synapse</span><span class="p">,</span> <span class="n">receptor_type</span><span class="o">=</span><span class="s1">&#39;excitatory&#39;</span><span class="p">)</span>

    <span class="c1"># run experiment</span>
    <span class="n">pynn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">n_synapses</span> <span class="o">*</span> <span class="n">time_between_inputs</span><span class="p">)</span>

    <span class="c1"># save membrane trace</span>
    <span class="n">mem</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">irregularlysampledsignals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">exercise_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;membrane_trace.txt&#39;</span><span class="p">),</span> <span class="n">mem</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>
    <span class="n">pynn</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">mem</span><span class="p">,</span> <span class="n">spike_times</span>
</pre></div>
</div>
<div class="section" id="id2">
<h3>Exercises<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h3>
<p>Extract the PSP height from the trace and plot it in a histogram.
You can use the functions you implemented above.</p>
<p>Hints:
* The function to plot histograms with matplotlib is called <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.hist.html">hist</a></p>
</div>
<div class="section" id="id3">
<h3>Solution<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h3>
<p>Please enter your solution here…</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mem</span><span class="p">,</span> <span class="n">spike_times</span> <span class="o">=</span> <span class="n">fixed_pattern_noise_experiment</span><span class="p">()</span>
<span class="n">heights</span> <span class="o">=</span> <span class="o">...</span>
<span class="c1"># TODO plot and save histogram</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="stacking-of-psps">
<h2>Stacking of PSPs<a class="headerlink" href="#stacking-of-psps" title="Permalink to this headline"></a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@interact</span><span class="p">(</span><span class="n">exc_weight</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">63</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">31</span><span class="p">),</span>
          <span class="n">inh_weight</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">63</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">31</span><span class="p">),</span>
          <span class="n">tau</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1022</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">26</span><span class="p">),</span>
          <span class="n">gm</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1022</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1022</span><span class="p">),</span>
          <span class="n">isi</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
          <span class="n">n_runs</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
          <span class="p">)</span>
<span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="n">exc_weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">inh_weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tau</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">gm</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">isi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n_runs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">return_results</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run external input demonstration on BSS-2.</span>

<span class="sd">    Adjust weight of projections, set input spikes and execute experiment</span>
<span class="sd">    on BSS-2.</span>

<span class="sd">    :param exc_weight: Weight of excitatory synaptic inputs, value range</span>
<span class="sd">        [0,63].</span>
<span class="sd">    :param inh_weight: Weight of inhibitory synaptic inputs, value range</span>
<span class="sd">        [0,63].</span>
<span class="sd">    :param isi: Time between synaptic inputs in microsecond (hardware</span>
<span class="sd">        domain)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Fourth experiment: External stimulation&quot;</span><span class="p">)</span>

    <span class="n">pynn</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">initial_config</span><span class="o">=</span><span class="n">calib</span><span class="p">)</span>

    <span class="c1"># use calibrated parameters for neuron</span>
    <span class="n">stimulated_p</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">HXNeuron</span><span class="p">(</span>
        <span class="n">excitatory_input_i_bias_tau</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span>
        <span class="n">excitatory_input_i_bias_gm</span><span class="o">=</span><span class="n">gm</span><span class="p">,</span>
        <span class="n">inhibitory_input_i_bias_tau</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span>
        <span class="n">inhibitory_input_i_bias_gm</span><span class="o">=</span><span class="n">gm</span>
    <span class="p">))</span>
    <span class="n">stimulated_p</span><span class="o">.</span><span class="n">record</span><span class="p">([</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;spikes&quot;</span><span class="p">])</span>

    <span class="c1"># calculate spike times</span>
    <span class="n">wait_before_experiment</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># ms (hw)</span>
    <span class="n">isi_ms</span> <span class="o">=</span> <span class="n">isi</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># convert to ms</span>
    <span class="n">spiketimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="n">isi_ms</span> <span class="o">+</span> <span class="n">wait_before_experiment</span>

    <span class="c1"># all but one input are chosen to be exciatory</span>
    <span class="n">excitatory_spike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">excitatory_spike</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># external input</span>
    <span class="n">exc_spikes</span> <span class="o">=</span> <span class="n">spiketimes</span><span class="p">[</span><span class="n">excitatory_spike</span><span class="p">]</span>
    <span class="n">exc_stim_pop</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">SpikeSourceArray</span><span class="p">(</span><span class="n">spike_times</span><span class="o">=</span><span class="n">exc_spikes</span><span class="p">))</span>
    <span class="n">exc_proj</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">exc_stim_pop</span><span class="p">,</span> <span class="n">stimulated_p</span><span class="p">,</span>
                               <span class="n">pynn</span><span class="o">.</span><span class="n">AllToAllConnector</span><span class="p">(),</span>
                               <span class="n">synapse_type</span><span class="o">=</span><span class="n">StaticSynapse</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="n">exc_weight</span><span class="p">),</span>
                               <span class="n">receptor_type</span><span class="o">=</span><span class="s2">&quot;excitatory&quot;</span><span class="p">)</span>

    <span class="n">inh_spikes</span> <span class="o">=</span> <span class="n">spiketimes</span><span class="p">[</span><span class="o">~</span><span class="n">excitatory_spike</span><span class="p">]</span>
    <span class="n">inh_stim_pop</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">SpikeSourceArray</span><span class="p">(</span><span class="n">spike_times</span><span class="o">=</span><span class="n">inh_spikes</span><span class="p">))</span>
    <span class="n">inh_proj</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">inh_stim_pop</span><span class="p">,</span> <span class="n">stimulated_p</span><span class="p">,</span>
                               <span class="n">pynn</span><span class="o">.</span><span class="n">AllToAllConnector</span><span class="p">(),</span>
                               <span class="n">synapse_type</span><span class="o">=</span><span class="n">StaticSynapse</span><span class="p">(</span><span class="n">weight</span><span class="o">=-</span><span class="n">inh_weight</span><span class="p">),</span>
                               <span class="n">receptor_type</span><span class="o">=</span><span class="s2">&quot;inhibitory&quot;</span><span class="p">)</span>

    <span class="c1"># run experiment</span>

    <span class="c1"># run experiment</span>
    <span class="n">voltages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mems</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">min_shape</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span>
    <span class="n">experiment_duration</span> <span class="o">=</span> <span class="mf">0.6</span>

    <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_runs</span><span class="p">):</span>
        <span class="n">pynn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">experiment_duration</span><span class="p">)</span>
        <span class="n">mem</span> <span class="o">=</span> <span class="n">stimulated_p</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">irregularlysampledsignals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plot_population_dynamics</span><span class="p">(</span><span class="n">stimulated_p</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
        <span class="n">mems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mem</span><span class="p">)</span>
        <span class="n">voltages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mem</span><span class="p">))</span>
        <span class="n">min_shape</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mem</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">min_shape</span><span class="p">)</span>
        <span class="n">pynn</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="n">voltages</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[:</span><span class="n">min_shape</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voltages</span><span class="p">]</span>
    <span class="n">voltages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">voltages</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_results</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">voltages</span>
</pre></div>
</div>
<div class="section" id="id4">
<h3>Exercises<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Adjust the time between the synaptic inputs and investigate when the neuron is firing.</p></li>
<li><p>Save a plot in which you can observe firing behaviour and save the parameters.</p></li>
</ul>
</div>
<div class="section" id="id5">
<h3>Solution<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h3>
<p>Document your observations here…</p>
</div>
</div>
<div class="section" id="behaviour-under-stimulation-by-a-poisson-process">
<h2>Behaviour under Stimulation by a Poisson Process<a class="headerlink" href="#behaviour-under-stimulation-by-a-poisson-process" title="Permalink to this headline"></a></h2>
<p>So far we have only looked at a single neuron receiving deterministic input. In this last exercise for this section of the lab course, we will look at one neuron receiving “stochastic”
input from two sources: an inhibitory and excitatory input source emitting spikes according to a poisson process with intensity $\lambda_e,\lambda_i$. Poisson processes occur frequently
in nature and have wide <a class="reference external" href="https://en.wikipedia.org/wiki/Poisson_point_process">applications in many areas</a>. One key point of this exercise
therefore is to give you an idea how a spiking neuron running on Neuromorphic Hardware
could naturally and efficiently process event data.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">poisson_spike_times</span><span class="p">(</span><span class="n">lambda0</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">delta_t</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">):</span>
    <span class="n">n_spikes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">lambda0</span> <span class="o">*</span> <span class="n">delta_t</span><span class="p">)</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">delta_t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_spikes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
</pre></div>
</div>
<p>The following code defines the experiment:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@interact</span><span class="p">(</span><span class="n">exc_weight</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">63</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">31</span><span class="p">),</span>
      <span class="n">inh_weight</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">63</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">31</span><span class="p">),</span>
      <span class="n">lambda_exc</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
      <span class="n">lambda_inh</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
      <span class="n">n_runs</span><span class="o">=</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">)</span>
<span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="n">exc_weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">inh_weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">lambda_exc</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lambda_inh</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">n_runs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">return_results</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run external input demonstration on BSS-2.</span>

<span class="sd">    Adjust weight of projections, set input spikes and execute experiment</span>
<span class="sd">    on BSS-2.</span>

<span class="sd">    :param exc_weight: Weight of excitatory synaptic inputs, value range</span>
<span class="sd">        [0,63].</span>
<span class="sd">    :param inh_weight: Weight of inhibitory synaptic inputs, value range</span>
<span class="sd">        [0,63].</span>
<span class="sd">    :param lambda_exc: excitatory poisson process intensity</span>
<span class="sd">    :param lambda_inh: inhibitory poisson process intensity</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Fourth experiment: External stimulation&quot;</span><span class="p">)</span>

    <span class="n">pynn</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">initial_config</span><span class="o">=</span><span class="n">calib</span><span class="p">)</span>

    <span class="c1"># use calibrated parameters for neuron</span>
    <span class="n">stimulated_p</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">HXNeuron</span><span class="p">())</span>
    <span class="n">stimulated_p</span><span class="o">.</span><span class="n">record</span><span class="p">([</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;spikes&quot;</span><span class="p">])</span>

    <span class="c1"># calculate spike times</span>
    <span class="n">experiment_duration</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">wait_before_experiment</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># ms (hw)</span>

    <span class="c1"># external input</span>
    <span class="n">exc_stim_pop</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">SpikeSourceArray</span><span class="p">(</span><span class="n">spike_times</span><span class="o">=</span><span class="p">[]))</span>
    <span class="n">exc_proj</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">exc_stim_pop</span><span class="p">,</span> <span class="n">stimulated_p</span><span class="p">,</span>
                               <span class="n">pynn</span><span class="o">.</span><span class="n">AllToAllConnector</span><span class="p">(),</span>
                               <span class="n">synapse_type</span><span class="o">=</span><span class="n">StaticSynapse</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="n">exc_weight</span><span class="p">),</span>
                               <span class="n">receptor_type</span><span class="o">=</span><span class="s2">&quot;excitatory&quot;</span><span class="p">)</span>

    <span class="n">inh_spike_source</span> <span class="o">=</span> <span class="n">SpikeSourceArray</span><span class="p">(</span><span class="n">spike_times</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">inh_stim_pop</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">inh_spike_source</span><span class="p">)</span>
    <span class="n">inh_proj</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">inh_stim_pop</span><span class="p">,</span> <span class="n">stimulated_p</span><span class="p">,</span>
                               <span class="n">pynn</span><span class="o">.</span><span class="n">AllToAllConnector</span><span class="p">(),</span>
                               <span class="n">synapse_type</span><span class="o">=</span><span class="n">StaticSynapse</span><span class="p">(</span><span class="n">weight</span><span class="o">=-</span><span class="n">inh_weight</span><span class="p">),</span>
                               <span class="n">receptor_type</span><span class="o">=</span><span class="s2">&quot;inhibitory&quot;</span><span class="p">)</span>

    <span class="c1"># run experiment</span>

    <span class="c1"># run experiment</span>
    <span class="n">voltages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mems</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">min_shape</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span>


    <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">trange</span><span class="p">(</span><span class="n">n_runs</span><span class="p">):</span>
        <span class="n">inh_spikes</span> <span class="o">=</span> <span class="n">poisson_spike_times</span><span class="p">(</span><span class="n">lambda_inh</span><span class="p">,</span> <span class="n">experiment_duration</span><span class="p">)</span> <span class="o">+</span> <span class="n">wait_before_experiment</span>
        <span class="n">inh_stim_pop</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">spike_times</span> <span class="o">=</span> <span class="n">inh_spikes</span><span class="p">)</span>
        <span class="n">exc_spikes</span> <span class="o">=</span> <span class="n">poisson_spike_times</span><span class="p">(</span><span class="n">lambda_exc</span><span class="p">,</span> <span class="n">experiment_duration</span><span class="p">)</span> <span class="o">+</span> <span class="n">wait_before_experiment</span>
        <span class="n">exc_stim_pop</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">spike_times</span> <span class="o">=</span> <span class="n">exc_spikes</span><span class="p">)</span>

        <span class="n">pynn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">experiment_duration</span><span class="p">)</span>
        <span class="n">mem</span> <span class="o">=</span> <span class="n">stimulated_p</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">irregularlysampledsignals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plot_population_dynamics</span><span class="p">(</span><span class="n">stimulated_p</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
        <span class="n">mems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mem</span><span class="p">)</span>
        <span class="n">voltages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mem</span><span class="p">))</span>
        <span class="n">min_shape</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mem</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">min_shape</span><span class="p">)</span>
        <span class="n">pynn</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="n">voltages</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[:</span><span class="n">min_shape</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voltages</span><span class="p">]</span>
    <span class="n">voltages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">voltages</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_results</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">voltages</span>
</pre></div>
</div>
<div class="section" id="id6">
<h3>Exercises<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h3>
<p>Explore the parameters offered by the experiment and describe your observations.
- Consider multiple runs (n &gt; 1), how would you characterise the behaviour over multiple runs.
- What happens if the intensity of the inhibitory and excitatory input differ widely?
- What happens if you change the weight of the inhibitory / excitatory input?
- What quantitative ways of analysing the observed behaviour come to your mind?</p>
</div>
<div class="section" id="solutions">
<h3>Solutions<a class="headerlink" href="#solutions" title="Permalink to this headline"></a></h3>
<p>Please give your solutions here…</p>
</div>
</div>
<div class="section" id="analysis-of-stimulation-by-a-poisson-process">
<h2>Analysis of Stimulation by a Poisson Process<a class="headerlink" href="#analysis-of-stimulation-by-a-poisson-process" title="Permalink to this headline"></a></h2>
<p>The following gives you a way to record membrane voltage traces
for given paramters over many runs (n_runs = 1000)</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">voltages</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">exc_weight</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">inh_weight</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">lambda_exc</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">lambda_inh</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n_runs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">return_results</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id7">
<h3>Exercises<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Plot a histogram of the voltages, for different parameter settings. Consider both population (over all runs) and a histograms over time for a single run.</p></li>
<li><p>How could you analyse the observed distribution further?</p></li>
</ul>
</div>
<div class="section" id="id8">
<h3>Solution<a class="headerlink" href="#id8" title="Permalink to this headline"></a></h3>
<p>Please type your solution here…</p>
<p>Hint: Consider plotting the histogram with density=True).</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="fp_calibration.html" class="btn btn-neutral float-left" title="Calibration: Characterising and Measuring Analog Behaviour" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="fp_adex_complex_dynamics.html" class="btn btn-neutral float-right" title="Complex Neuron Dynamics with a Silicon Adaptive Exponential Integrate-and-Fire Neuron" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Electronic Vision(s).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>